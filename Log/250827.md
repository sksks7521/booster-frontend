## 250827 진행 로그

### v2 상세 페이지 구조/연동

- 상단: 기존 요약/상세(`PropertyDetailSimple`) 유지
- 비교 분석 영역: 데이터셋 대탭(과거경매결과/실거래가 매매/전월세/네이버)
  - 서브탭: 목록/지도/통합
  - 선택된 필터 바 상단 배치, 우측 필터 패널 접힘/펼침 유지
- URL 동기화: `ds` 쿼리 반영(탭 전환 시 replace)

### 필터/스토어 네임스페이스

- `useFilterStore`에 `ns` 오버라이드 저장소 도입
  - `setNsFilter`, `setNsRangeFilter`, `resetNsFilters`
- `FilterControl`/`SelectedFilterBar`가 `namespace` 기반으로 상태 읽기/쓰기
- `FilterControl`의 `defaults` 1회 주입(useEffect, 범위/단일 자동 판별)

### 목록 테이블 동적화

- `ItemTable`에 `schemaColumns`, `getValueForKey` 추가 → 데이터셋별 컬럼 주입형 렌더링
- v2 목록/통합 탭에서 기존 간이 테이블 제거, `ItemTable`로 교체

### 지도 컴포넌트 확장/연동

- `MapView`에 전략 프롭 추가: `markerColorFn`, `legendItems`, `namespace`
- v2 지도/통합 탭에서 `datasetConfigs[ds].map.marker`를 `markerColorFn`으로 전달

### 레이아웃/접힘 버그 수정

- 좌측 영역에 `min-w-0`, 우측 패널 접힘 시 `hidden` + 컨테이너 `gap-0`
- analysis 페이지에도 동일 적용(접힘 시 좌측 너비 축소 현상 해결)

### 기타 수정

- v2 파일 상단 `"use client"` 위치 오류 수정(최상단으로 이동)
- 중복 import/중복 상태 선언/Hook 순서 오류 등 린트 및 런타임 에러 정리

### 다음 단계(상세 계획)

- **plan-08-wire-v2 마무리(연동 안정화)**

  - v2 탭/서브탭 URL 동기화 확장: `view`(list|map|integrated) 쿼리 추가, 뒤로가기 동작 확인
  - `SelectedFilterBar` 배치/동작 확정: 네임스페이스별 카운트/초기화 동작 검증
  - 통합 탭 레이아웃 고정: 상단 지도, 하단 목록 높이/반응형 규칙 명시(`min-h`, `max-h`, 스크롤 분리)
  - v2 전 구간에서 `useDataset` 사용 일원화: 목록/지도 모두 동일 키/필터 파이프 사용
  - 수용 기준: 탭/서브탭/URL/필터/지도 전환 시 레이아웃 튐/리마운트 이슈 무, 빈 데이터 안전 동작

- **plan-09-config-sale-rent-naver: 데이터셋 설정/어댑터 구현**

  - `Application/datasets/registry.ts`에 `sale`, `rent`, `naver` `DatasetConfig` 추가
    - API: 엔드포인트/쿼리 매핑 정의(백엔드 응답 전까지는 목/스텁로 빈 리스트 반환)
    - Adapter: 원시 응답 → `ItemLike` 매핑 함수 작성(좌표 키 변형·스왑 방지 로직 포함)
    - Table: `schemaColumns` 정의(컬럼 키·헤더·셀 포맷터)
    - Filter: `defaults`/`preset` 구성(범위/단일/체크·선택), `namespace` 별 초기 주입 확인
    - Map: `markerColorFn`/`legendItems` 전략 수립(가격 구간/보증금·월세 구간/매물 유형 등)
  - 연동: v2에서 탭 전환 시 각 데이터셋 설정이 즉시 반영(목록/지도/통합/필터/범례)
  - 수용 기준: 3개 데이터셋 모두 로딩·빈값·전환 시 에러 없이 기본 UI 동작

- **plan-10-empty-states: 로딩/빈값/에러 상태 표준화**

  - 공통 상태 유틸: `useViewState(status, total)` 혹은 헬퍼 제작 → 각 뷰에서 동일 정책 사용
  - 로딩: 목록 스켈레톤(Row 반복) · 지도 스켈레톤(로더/메시지)
  - 빈값: "검색결과 0건" 메시지 + 재설정/범위확대 CTA, 지도 중심/레벨 유지
  - 에러: 비차단 배너(재시도 버튼) + 로그 캡처(SWR onError)
  - 수용 기준: 4 데이터셋×3 뷰에서 상태 표현과 상호작용 일관

- **plan-11-perf: 성능 최적화(지도/목록)**

  - 지도 bounds 기반 페치: `MapView` → `useDataset` 키에 `bounds` 반영, 쓰로틀/디바운스 적용
  - SWR 최적화: `keepPreviousData`, `dedupingInterval`, 부분 키 스코프 분리로 레이스 감소
  - 마커 최적화: 클러스터링 옵션/단계, 마커 재생성 최소화(키/메모이제이션)
  - 목록 최적화: 가상 스크롤(필요 시 `item-table.tanstack.tsx`로 전환) + 컬럼 포맷 캐시
  - 페이징: 서버 `page/limit/sort` 파라미터 협의·적용, 뷰간 상태 보존
  - 수용 기준: 1천개 규모 데이터에서 스크롤·지도 이동 시 프리즈/렉 없이 매끄럽게 동작

- **plan-12-docs: 문서/가이드 보강**

  - 백엔드 계약 문서 링크: `Communication/Backend/send/Request/250827_*.md`를 `FRONTEND_ARCHITECTURE.md`와 v2 코드 주석에서 참조
  - 개발 가이드: `DatasetConfig` 작성법, Adapter 패턴, 필터 네임스페이스 사용법, 지도 범례 전략 정리
  - 맵 노트 업데이트: `Doc/LearnBook/KakaoMap_Guide_Notes.md`에 legend/marker 사례·성능 팁 추가
  - 수용 기준: 신규 기여자가 문서만 보고 데이터셋 1개를 독자적으로 추가 가능

- **QA/스모크 테스트**

  - 스크립트: `scripts/smoke-detail.ps1` 확장(v2 경로·ds/view 조합 스모크), 네트워크 실패 시 재시도
  - 환경 변수: `NEXT_PUBLIC_DETAIL_DEBUG`로 디버그 패널/로그 토글 확인
  - 기본 시나리오: ds 전환 → 필터 변경 → 목록/지도/통합 전환 → 새로고침/딥링크 재현

- **마일스톤 수용 기준(요약)**
  - v2에서 4 데이터셋(과거경매·매매·전월세·네이버) 탭/필터/목록/지도/통합 일관 동작
  - 빈값/에러/로딩 표준화, URL 동기화 및 복원, 성능 기준 충족
  - 문서화 완료(구성·패턴·계약), 스모크 스크립트 그린
