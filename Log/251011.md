---

## 실거래가(전월세) 계획서(RENT_PLAN) 보강 (2025-10-10)

- 아웃라인 정리 및 SALE → RENT 차이 요약 추가
  - 엔드포인트/정렬/핵심 지표/범례 임계값/주소검색/ids 필터 정리
- 필터/정렬/지도 정책 구체화
  - 서버 파라미터 매핑 초안: 보증금/월세/면적/연식/기간/구분/계약구분/주소검색/ids
  - 정렬 `ordering=-snake_case` 변환 규칙 명시
  - 지도 범례 기준 제안(A: 보증금, B: 월세, C: 복합가격 k)
- 분석/모니터링 이벤트 섹션 추가
  - sort_changed, filter_applied, map_marker_click, view_switched, page_changed, error_shown, empty_state
- 사용자 선호 저장 키 섹션 추가
  - `table:order:rent`, `table:width:rent`, `table:sort:rent`, `pageSize:rent`, `rent:maxMarkersCap`, `rent:useClustering`, `rent:legend:mode`, `rent:view:last`
- 환경 변수 매트릭스 확장
  - `NEXT_PUBLIC_RENT_PRICE_K`, `NEXT_PUBLIC_RENT_LEGEND`, SWR 옵션 등 추가
- QA 스모크 예시 보강(curl/PowerShell)
  - 정렬/범위/주소검색/ids/columns 요청 샘플 추가
- 에러/빈데이터 안내 문구 템플릿 추가
  - 데이터 없음/네트워크 오류/좌표 결측/429 안내 문구
- 접근성(ARIA) 체크리스트 추가
  - 테이블 셀 라벨/정렬 버튼/마커 title/키보드 탐색/색 대비
- 팝업 스키마 템플릿(선택) 추가
  - `/real-rents/by-address` 가정, 건물 공통 정보 + 계약 이력 표 사양
- 성능/SLA 목표(초안) 추가
  - API 응답 목표, SWR dedupe/포커스 정책, 마커 상한, 테이블/지도 상호작용 목표

변경 파일

- `Doc/RealTransactions/RENT_PLAN.md`

## 오늘 할 일(전월세 v2) — 2025-10-11

- [ ] PHASE 1: 백엔드 스모크 체크

  - [ ] GET `/api/v1/real-rents/?page=1&size=20` 200 OK, 응답 `items`,`total` 확인
  - [ ] `sido/sigungu/admin_dong_name` 지역 필터 동작 확인
  - [ ] GET `/api/v1/real-rents/columns` 응답 형식 확인(legacy vs new)
  - [ ] 정렬 전달: `ordering=-snake_case` 반영 검증 (예: `depositAmount desc` → `-deposit_amount`)
  - [ ] 범위 필터(보증금/월세/면적/연식/기간) 최소 조합 200 OK

- [ ] PHASE 2: 데이터셋/정렬/필터 최종화

  - [ ] `RENT_FILTERS` 화이트리스트/서버 매핑 점검, `ids` ≤ 500 제한 확인
  - [ ] 딥링크/정렬 허용키(`useSortableColumns("rent")`) 정합 검증

- [ ] PHASE 3: UI 컴포넌트 보강(복제·치환)

  - [ ] `RentFilter.tsx`: 주소검색 옵션·기간·보증금/월세/면적/연식/구분/계약구분/ids 정합
  - [ ] `RentSearchResults.tsx`: 통합 뷰 선택→지도강조→중심 이동, 페이지네이션/가상스크롤
  - [ ] 원형 필터 통합: `useCircleFilterPipeline` ns="rent", “영역 안만 보기” + `ids` 서버 필터 연동

- [ ] PHASE 4: 지도 범례/ENV/분석

  - [ ] `NEXT_PUBLIC_RENT_PRICE_K`, `NEXT_PUBLIC_RENT_LEGEND` 적용, 라벨/팔레트 확정
  - [ ] 분석 이벤트/선호 키(:rent) 적용, 접근성(aria-label/title) 점검

- [ ] PHASE 5(선택): 팝업/수익률
  - [ ] `/real-rents/by-address` 팝업 스키마, `/rental-yield` 보조 카드/차트

### 복사/치환 계획(무엇을, 어디에, 언제)

- 시점

  - 데이터셋/매핑은 PHASE 2에서 확정
  - UI 컴포넌트 복제·치환은 PHASE 3에서 실행

- 복사 원본 → 대상(전월세)

  - `Application/components/features/sale/SaleSearchResults.tsx` → `components/features/rent/RentSearchResults.tsx` 비교·필요 부분 보강
  - `Application/components/features/sale/SaleFilter.tsx` → `components/features/rent/RentFilter.tsx` 비교·필드 치환
  - `Application/datasets/registry.ts` 내 `sale` 설정 → `rent` 설정과 대조해 매핑 차이 적용

- 치환 항목(주요)

  - 엔드포인트: `/api/v1/real-transactions/` → `/api/v1/real-rents/`
  - 정렬 키: `transactionAmount/contractDate` → `depositAmount/monthlyRent/contractDate`
  - 필터: `transactionAmountRange/pricePerPyeongRange` → `depositRange/monthlyRentRange/areaRange/buildYearRange/dateRange/rentType/contractType`
  - 범례 임계값: 매매 기준 → 전월세 기준(ENV)
  - 분석/선호 키 네임스페이스: `:sale` → `:rent`

- 산출물(파일)
  - `components/features/rent/RentFilter.tsx`, `components/features/rent/RentSearchResults.tsx`
  - `Application/datasets/contracts.ts`(`columnsRent`)
  - `Application/datasets/registry.ts`(`datasetConfigs.rent`)
  - `Application/hooks/useSortableColumns.ts`(rent 케이스)
  - `Application/lib/api.ts`(`realRentApi`)
  - `components/features/MapLegend.tsx`(전월세 범례 설정)

## 결정값(사용자 확정) — 2025-10-11

- 기본 정렬: 계약일자 최신순(desc)
- 범례 기준: 전월세전환금(5%) (단위: 만원)
- 범례 임계값: 6000, 8000, 10000, 13000 (만원)
- 복합가격 k: 미정(현재 사용 안 함)
- 주소 검색: 도로명/지번 모두 사용(매매와 동일, Option A 적용)
- ids 서버 필터: “선택만 보기” ON일 때만 전송(매매와 동일), 최대 500
- 페이지 사이즈: 매매와 동일(기본 20)

ENV 초안

- NEXT_PUBLIC_RENT_LEGEND_MODE=conversion
- NEXT_PUBLIC_RENT_LEGEND=6000,8000,10000,13000
- NEXT_PUBLIC_RENT_PRICE_K=100

---

### 진행 업데이트 — 2025-10-11 PM

- 완료

  - [x] `/api/v1/real-rents/`, `/columns` 스모크 200 OK
  - [x] `datasetConfigs.rent` 기본 정렬 `contractDate desc` 반영, `sigungu` 정규화 전처리 추가
  - [x] `columnsRent` 재정렬 및 스키마 확정(대지권면적 제외, 갱신차이(%) 위치 조정)
  - [x] 지도 마커 라벨(Y/N), 렌트 범례 힌트(Y/N 엘리베이터 여부) 적용
  - [x] `useSortableColumns("rent")`가 `/real-rents/columns` 사용하도록 수정
  - [x] 지도 팝업: `/real-rents/by-address` + `rentSchema` 연동, snake/camel 혼용 키 보강
  - [x] 렌트 전용 `RentFilter.tsx` 지역 드롭다운을 실거래가 정규 API로 전환
  - [x] 상단 공통 지역 카드(`v2/page.tsx`)에서 렌트 탭도 정규 API로 전환(읍면동 활성화)
  - [x] 시군구 미선택 시 목록/지도 호출 차단 게이트 확인

- 진행 중

  - [ ] 원형 필터 파이프라인(ns="rent") 통합 및 스모크
  - [ ] ENV 적용: `NEXT_PUBLIC_RENT_LEGEND_MODE`, `NEXT_PUBLIC_RENT_LEGEND` 최종값 반영
  - [ ] 분석 이벤트/로컬 선호 키(:rent) 적용, 접근성 문구 보강

- 이슈/백엔드 커뮤니케이션
  - `/real-rents/by-address` 422 라우팅 충돌 → 요청서 발송(우선순위/패턴 구분)
  - 지역 필터 AND 조건 불일치 재현 보고/수정 요청 문서 발송, 답신 반영 예정
