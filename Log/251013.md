# 251013 변경 로그

## v2 과거 경매결과: 목록/지도 총량 불일치 수정

- 배경: 초기 진입 시 목록 총량 946 vs 지도 총량 664 불일치 재현. 백엔드 분석 결과, 지도(`/map`) 호출에 기본 가격 파라미터(`0~500000만원`)가 항상 포함되어 가격 미기재/0원 항목이 제외됨.

### 프론트엔드 조치

- 지도 `/map` 가격 파라미터 전송 가드 추가

  - 파일: `Application/components/features/auction-ed/AuctionEdSearchResults.tsx`
  - 내용: `serverFilterPayload` 생성 시 가격이 기본값(0~500000)인 경우 `min_final_sale_price`/`max_final_sale_price` 미전송.

- 영역 `/area` 빌더 동일 가드 적용
  - 파일: `Application/components/features/auction-ed/areaQuery.ts`
  - 내용: 가격 기본값이면 `price_min`/`price_max` 미전송. 상한 보정(미만 규칙) 로직은 유지.

### 특수권리(/map, /area) 연동 개선

- 지도 `/map` 파라미터 보강

  - 파일: `Application/components/features/auction-ed/AuctionEdSearchResults.tsx`
  - 내용: 라벨만 선택해도 라벨→키 역매핑으로 `special_conditions`(canonical 키 CSV) 생성해 전송. 기존 `special_rights`(라벨/키 혼합 CSV)도 유지.

- 영역 `/area` 쿼리 보강
  - 파일: `Application/components/features/auction-ed/areaQuery.ts`
  - 내용: `specialBooleanFlags`를 `special_conditions`로 병합해 전송. `special_rights`(라벨 CSV) 병행.

### 검증 포인트(특수권리)

- 특수권리 토글 시 `/map` URL에 `special_conditions=키1,키2` 포함.
- 여러 개 선택 시 CSV 병합, 해제 시 파라미터 제거.
- 목록 total과 `/map echo.totals.pre_spatial_total`이 같은 방향으로 변화.

### 기대 효과 / 검증 포인트

- 초기/탭 전환/지도 이동 시 `/map total`과 목록 total 일치.
- `/map` 응답의 `echo.totals.pre_spatial_total`이 목록 total과 동일.
- 가격 필터를 실제로 조정한 경우에만 해당 파라미터 전송됨.

### 참조 문서

- `Communication/Backend/receive/Completed/251013_Backend_to_Frontend_auction-completed-map-total-consistency-REQUEST.md`
