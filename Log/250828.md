## 250828 진행 로그

### 오늘의 작업 계획(체크리스트)

- [ ] Kakao 전환: `.env`에 `NEXT_PUBLIC_KAKAO_APP_KEY` 반영, `NEXT_PUBLIC_MAP_PROVIDER=kakao` 스위치, 로컬 스모크(지도 로드/마커/콘솔 에러 0)
- [ ] API 마이그레이션: `real-transactions`/`real-rents`/`auction-completed`를 `page`/`size`로 전환, 응답(`total`/`page`/`total_pages`) 처리 업데이트, 공용 호출 유틸 통합
- [ ] 분석 페이지 컬럼 순서 저장: User Preferences API(`PUT/GET/DELETE /api/v1/user-preferences/analysis/column_order`) 연동 및 DnD 저장
- [ ] v2 상세페이지 연동 안정화: URL 쿼리 `ds`+`view` 동기화, `SelectedFilterBar` 네임스페이스 카운트/초기화, 통합 탭(상단 지도/하단 목록) 레이아웃 고정, `useDataset` 일원화
- [ ] 데이터셋 설정 추가: `sale`/`rent`/`naver` `DatasetConfig`(API 매핑/어댑터/테이블/필터/지도 마커 전략) 스텁 도입
- [ ] 상태 표준화: 로딩/빈값/에러 공통 유틸 적용(`keepPreviousData`, 재시도 버튼, 빈결과 안내)
- [ ] 지도 성능: Kakao `MarkerClusterer` 기본 정책 적용(≤9 병합, 10–12 부분, ≥13 개별), 가시영역 렌더/오버레이 재사용, 이벤트 디바운스(200/300/200ms)
- [ ] 문서화: v2 패턴/Adapter/네임스페이스/범례 전략 정리, 백엔드 계약 문서 링크 반영

### DoD / Acceptance Criteria

- Kakao 스모크: 지도 타일/줌/팬/마커/팝업 정상, 콘솔 에러 0, 모바일 팝업 `max-height` 적용
- API 전환: 3개 API 호출에 `page/size` 적용, 목록/페이지네이션 정상, 총계 필드 참조 오류 0
- Preferences: 컬럼 순서 저장/조회/삭제 동작, 새로고침 후 유지, 404 시 기본 순서 적용
- v2 안정화: 탭/서브탭/URL/필터/지도 전환 시 레이아웃 튐/리마운트 이슈 없음, 빈 데이터 안전 동작
- 데이터셋 3종: 스텁 기준 전환 시 오류 0, 테이블/지도/필터 UI 렌더
- 상태 표준화: 4 데이터셋×3 뷰에서 동일 정책 표현 및 상호작용
- 성능: 1k 규모 데이터에서 스크롤/지도 이동 프리즈 없이 매끄럽게 동작

### 의존성 / 리스크

- Kakao JS 키 전달/도메인 등록(Infra 요청 대기), dev/stg 도메인 목록 확인 필요
- API 변경 범위가 넓어 회귀 리스크 존재 → 공용 유틸로 분기 최소화, 스모크 강화
- 대용량 지도 렌더 시 성능 이슈 → 클러스터 정책/오버레이 재사용로 완화

### 참고 파일

- `Communication/Backend/receive/Request/250821_Backend_to_Frontend_API_일관성_통합_연동가이드_v2.0_제공.md`
- `Communication/Backend/receive/Request/250826_Items_상세_표준_필드_사양.md`
- `Communication/Pipeline/receive/Request/250823_Frontend_to_Pipeline_Auction_ing_Map_Spec_Request_답변.md`
- `Communication/Infra/receive/Request/250813_Infra_to_Frontend_Kakao_도메인_등록_및_JS_키_확인_요청.md`
- `AIRead.md`

### 진행 현황(퍼센트)

- 0%

### 다음에 할 일 (Next Steps)

1. Infra에 dev/stg 도메인 목록 회신 및 Kakao JS 키 수신 → `.env` 반영
2. 공용 API 호출 유틸에 `auction-items`(skip/limit) vs 기타(page/size) 분기 적용, 호출부 교체
3. 분석 테이블에 컬럼 순서 훅/SWR 연동 및 DnD 저장 트리거 적용, 404 폴백 검증
4. v2 URL 쿼리(`ds`,`view`) 동기화 및 `SelectedFilterBar` 네임스페이스 동작 확정
5. `sale`/`rent`/`naver` 데이터셋 설정/어댑터/테이블/필터/지도 마커 전략 스텁 구현
6. 로딩/빈값/에러 상태 컴포넌트 공통화 후 4 데이터셋×3 뷰에 적용
7. Kakao 클러스터/디바운스/오버레이 재사용 적용 및 QA 체크리스트 통과
8. 문서/가이드 갱신 및 스모크 스크립트 업데이트

---

### 남은 과제(실행 순서 제안)

1. 매물(listings) 실 API 전환 준비

- 백엔드 파이프라인 준비 시 `datasets/registry.ts`의 listings `buildListKey/fetchList` 실 경로로 교체
- `useSortableColumns` 연동하여 정렬 화이트리스트 적용
- E2E에 listings 실서버 케이스 추가

2. 지도/성능 운영값 확정(ENV)

- NEXT_PUBLIC_MAP_MIN_FETCH_LEVEL: 9(보수) 또는 8(민감)
- NEXT_PUBLIC_MAP_MAX_AREA_KM2: 1000~1500 권장
- NEXT_PUBLIC_MAP_BOUNDS_DEBOUNCE_MS: 300~500ms
- NEXT_PUBLIC_MAP_CLUSTER_DEBOUNCE_MS: 200~300ms
- NEXT_PUBLIC_MAP_MAX_MARKERS: 1500 기본

3. UX/가이드

- 비로그인 시 컬럼 순서 저장 불가 툴팁 표기(401 가드 완료)
- 면적 표기 기본 정책 확정(㎡/평/병기, 반올림 규칙)
- 탭/데이터셋 전환 시 상태 복원 범위 재확인(현 구현 기준 정책 문구 정리)

4. 관측성 강화

- Sentry breadcrumb: 주요 라우트 전환·지도 바운즈 변경 이벤트 추가 로깅
- 간단 대시보드 뷰(오류 추이, API 응답속도) 구성

5. 안정화

- 어댑터(zod) 경계값 재점검(좌표/가격/연도 아웃라이어)
- 빈 상태/에러 상태 카피라이팅 미세 조정

### 운영 가이드(비밀 제외)

- .env.local에 NEXT*PUBLIC*\*만 배치(비밀키 금지). Kakao JS 키는 공개 전제
- PowerShell 일시 적용 시 줄바꿈으로 환경변수 설정 후 `npm run dev`

### 검증 포인트(릴리즈 전)

- 데이터셋 전환/정렬/페이지/지도 이동 E2E 녹색
- v2 탭 전환 시 0건 회귀 없음(useDataset center+radius 우선 로직 적용 확인)
- 지도 최소 줌/면적 가드/디바운스 동작 및 마커 표시 상한 튜닝 확인
