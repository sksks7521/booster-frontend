2025-08-26 작업 로그

변경/계획 요약

- 지도 팝업 UI 2차 정렬(섹션 순서/강조 톤 재배치)
- 카드 요약치에 서브메타(아이콘/툴팁/단위) 추가 및 라벨 축약
- 특수권리 문구 토큰화 및 위험 키워드 하이라이트
- 상단 액션(공유/인쇄/즐겨찾기) 상태 유지(localStorage) 및 토스트 처리
- 인쇄용 레이아웃(CSS @media print) 최적화
- API 페이징 정책 변경 반영: real-transactions/real-rents/auction-completed → page/size (auction-items는 skip/limit 유지)
- Kakao 도메인/JS 키 체크리스트 재확인(Infra 요청 대응) 및 지도 렌더 재검증

# 오늘 계획(체크리스트)

- [ ] 팝업 UI 2차 정렬: 상단 핵심 KPI → 위험/유의 → 기본/시설 → 기타 순서 재배치
- [ ] 카드 요약치 서브메타 삽입: 아이콘/툴팁/단위 병기, 라벨 축약
- [ ] 특수권리 문구 토큰화 및 위험 키워드 하이라이트(색상/밑줄/아이콘)
- [ ] 상단 액션(공유/인쇄/즐겨찾기) 상태 유지(localStorage) 및 토스트 노출(3초)
- [ ] 인쇄용 레이아웃 최적화(@media print, 페이지 분리/여백/폰트 크기)
- [ ] API 페이징 정책 변경 반영 및 검증(실 호출 3종 page/size, auction-items 호환성 유지)
- [ ] Kakao JS 키/도메인 등록 상태 재확인(로컬/개발/운영) 및 지도 스모크(로드/줌/팬/마커, 콘솔 에러 0)

## DoD / Acceptance Criteria

- [ ] 팝업 섹션 순서가 기획안대로 재배치되고 시각적 강조 톤이 일관된다
- [ ] 카드 요약치에 아이콘/툴팁/단위가 병기되고 모바일에서도 겹침 없이 보인다
- [ ] 특수권리 위험 키워드가 하이라이트되어 1~2초 내 스캔 가능하다
- [ ] 공유/인쇄/즐겨찾기 상태가 새로고침 후에도 유지된다(localStorage)
- [ ] 인쇄 미리보기에서 표/카드가 페이지 분리 규칙을 준수한다(잘림/겹침 없음)
- [ ] real-transactions/real-rents/auction-completed는 page/size로 정상 페이징, auction-items는 기존 skip/limit로 정상 동작
- [ ] Kakao 지도 스모크 체크 통과(배지/축척/외부 링크 표시, 콘솔 에러 0)

## 의존성/리스크

- Kakao JS 키 도메인 허용 목록(로컬/개발/운영) 미등록 시 403 위험
- 대량 마커 시 성능 저하 가능 → 추후 MarkerClusterer 적용 필요
- API 페이징 정책 변경에 따른 회귀 위험(목록/테이블 페이지네이션 연동 확인 필요)
- OneDrive 경로 인코딩 이슈 재발 가능 → 에디터/런타임 인코딩 주의

## 참고 파일

- Application/components/features/map-view.tsx
- Application/components/features/property-detail/\*
- Application/lib/api.ts, Application/hooks/useItems.ts, Application/hooks/useItemDetail.ts
- Communication/Pipeline/receive/Request/250823*Frontend_to_Pipeline_Auction_ing_Map_Spec_Request*답변.md
- Communication/Infra/receive/Request/250813\_\* (Amplify, Kakao, VWorld 관련)
- Communication/Backend/receive/Request/250821*Backend_to_Frontend_API*일관성*통합*연동가이드*v2.0*제공.md
- Doc/FRONTEND_ARCHITECTURE.md, Doc/PROJECT_FRONTEND_ROADMAP.md

## 진행 현황(%)

- 오늘 범위 진행률: 0%

## 다음에 할 일(Next Steps)

1. 팝업 UI 2차 정렬 및 서브메타/라벨 적용
2. 특수권리 토큰화 + 위험 키워드 하이라이트 적용
3. 상단 액션 상태 유지 및 토스트 처리 구현
4. 인쇄 레이아웃 최적화(@media print)
5. 3개 API 페이징 정책 코드 반영 및 스모크 검증
6. Kakao 도메인/키/지도 스모크 재검증 및 기록

---

## 지도/필터 정합성 및 줌 정책 반영 (2025-08-26)

- 지역 전환/최초 진입 줌 레벨 통일: level=8 고정 적용
  - 위치: `Application/components/features/map-view.tsx`
  - 초기 지도 생성 옵션과 지역 이동 후 `fitBounds` 직후 `setLevel(8)` 적용
- 중심 동기화 안정화
  - 지역 전환 시 `pendingFitRef`로 데이터 로드 완료 타이밍에 1회 `fitBounds` 보장
  - `setCenter`/`fitBounds` 직후 `centerCoord`/`lastCenterRef` 즉시 동기화(Idle 의존 축소)
- 좌측 좌표 오버레이에 줌 표기 추가: `z=08` 형식 노출
- 지도 데이터 소스 일원화: 페이지 데이터가 아닌 “필터 적용 전체(mapItems)” 기준으로 마커 생성
  - 목록은 페이지네이션 유지(표시는 20개), 지도는 필터 결과 전체(상한 내) 렌더
- 설정 초기화 정책 보정(필터와 데이터 정합성)
  - 위치: `Application/components/features/filter-control.tsx`
  - ‘설정 초기화’ 시 매각기일을 오늘~+1개월로 기본 세팅하여 클라이언트 필터가 즉시 활성화되도록 수정
  - 결과: 상단 ‘필터 N건’과 지도 마커 수가 일치(예: 고양시 182→필터 43, 지도 43)

## 지도 UI/상호작용 개선 (2025-08-26)

- 지도 타입 토글(일반/위성/하이브리드) 추가: 좌상단 '전체화면' 옆 배치
- 좌표 카드 이동: 좌하단 → 우하단, `z=..` 표기 및 줌 +/− 버튼 추가
- 복사 토스트 위치/애니메이션: 전체 창 중앙 상단, 2초 표시(슬라이드+페이드)
- 선택 강조: 체크된 항목 위치에 화살표형 오버레이 표시(지도 중심 이동 없음)
- 상세 오픈 정책: 마커 클릭 시 팝업만 열리고, 팝업의 ‘상세보기’ 클릭 시에만 상세 다이얼로그 오픈
- 중복 상세 열림 방지: `ItemTable`의 `property:openDetail` 리스너 제거, 페이지 상위 한 곳에서만 처리
- ‘선택 항목만 보기’ 토글: 상세 필터 패널 전용으로 노출, URL `?selOnly=1` 동기화, 지역 변경 시 자동 해제 및 선택 초기화

### 재현/검증 로그 요약

- 경기도 고양시 선택 → 설정 초기화 → 지도 탭
  - 서버 총 182건 수신 → 매각기일 필터 적용 후 43건(클라이언트 처리)
  - 지도 오버레이: ‘항목 43개’, 중앙 좌표 z=08
  - 목록 상단: ‘필터 43건’과 일치

### 영향 범위/리스크

- 기능 추가/변형 없음: 표시 중인 필터와 실제 데이터/지도 기준만 일치시킴
- 대량 데이터일 때 지도 렌더 비용 증가 가능(상한 1000/2000 유지). 필요 시 서버 필터 파라미터 확장 고려
