2025-08-23 작업 로그

변경 요약
- 지도 팝업(데스크톱 CustomOverlay, 모바일 Sheet) 컬럼 확장: 현재상태, 건물평형, 층확인, Elevator, 건축연도, 최저가/공시가격, 특수조건(불리언 플래그 OR 문자열) 표시.
- 레이아웃 개선: 팝업 폭 고정(270px), 특수조건 줄바꿈 처리, 상단 액션(관심물건, 공유), 주소/사건번호 복사 pill 버튼, 하단 닫기/상세보기 버튼.
- 접근성: 금액/비율/날짜 aria-label 적용.
- 토스트: 지도 컨테이너 기준 정하단 중앙에 3초 노출.
- 중앙정렬: 마커 클릭 시 Kakao 투영 사용해 panBy(-dx,-dy)로 십자가 중앙에 안착. 투영 불가 시 panTo → setCenter 폴백.
- 팝업 상호작용: 내부 스크롤/클릭은 맵 이벤트 버블 차단. 배경 클릭/드래그/줌으로 자동 닫힘 제거(요청 반영).
- ‘팝업 유지’ 기능: 시도 후 사용자 요청으로 완전 제거. 관련 전역/아이콘/버튼 코드 삭제.

기타
- 지도 중앙 크로스헤어 오버레이 추가(pointer-events:none).
- 불필요한 중앙정렬 중복 호출 정리.

영향 파일
- Application/components/features/map-view.tsx
- Application/store/filterStore.ts (팝업 유지 전역 상태 추가 후 제거)
- Doc/LearnBook/KakaoMap_Guide_Notes.md (아래 업데이트와 동일한 내용 반영 예정)

# 250823 작업 로그 (분석 페이지 · 지도 선정/점검)

## 변경/점검 요약

- 지도 Provider: Kakao 전환 상태 확인 완료 (`NEXT_PUBLIC_MAP_PROVIDER=kakao`).
- /analysis 페이지 지도 탭에서 Kakao 지도 정상 렌더(배지/축척/링크 확인), 오류 없음.
- 팝업(UI) 1차 고도화 진행: 하이라이트/핵심 배지/가격 비교 바/카드 비주얼, 빌딩/시설 섹션 추가.
- 초기 상태: 지역 미선택으로 항목 0개 표시(의도된 동작). 지역 선택 시 데이터 로딩 예정.
- vworld → kakao 폴백 구조 유지, 전체화면 토글 시 relayout + center 유지 동작 확인.

## 현재 상태 상세

- 환경변수: `NEXT_PUBLIC_KAKAO_APP_KEY` 적용됨(로컬).
- 컴포넌트: `Application/components/features/map-view.tsx`의 Provider 스위치에 따라 Kakao SDK 로드 확인.
- 초기 중심/레벨: 서울시청 근방, level=4 기본값 적용.
- 아이템 렌더: 지역 미선택으로 목록/마커 0개(정상).
- 팝업 구조(파일):
  - `PropertyDetailDialog.tsx` (컨테이너)
  - sections/
    - `Header.tsx`(아이콘 메타 적용) + `HeaderActions.tsx`(공유/인쇄/즐겨찾기)
    - `PriceHighlight.tsx`(강조형 1x4), `PriceDetailCard.tsx`, `PriceCompareBar.tsx`
    - `AreaInfoCard.tsx`(평↔㎡ 동시표기), `ScheduleStatusCard.tsx`
    - `KeyBadges.tsx`(1억/엘리베이터/층확인), `RiskSummaryCard.tsx`(특수권리 경고)
    - `BuildingInfoCard.tsx`, `FacilityInfoCard.tsx`

## 콘솔/네트워크 관찰

- SWR: `GET /api/v1/locations/tree-simple` 요청 확인(주소 데이터 로딩).
- 디버그 로그: 지역 미선택 시 "데이터 로딩 중지" 경고 반복 로그 확인(설계된 가드 동작).
- Kakao SDK 로드 오류 없음. 지도 배지/축척바/외부 링크 노출로 정상 렌더링 확인.

## DoD / Acceptance Criteria

- [x] 지도 탭 진입 시 Kakao 지도 요소가 정상 노출된다(배지, 100m 축척, 외부 링크 표시).
- [x] SDK 로드 에러 및 CORS/403 이슈가 없다.
- [x] 전체화면 토글 시 `relayout()` 호출 후 중심 좌표가 유지된다.
- [x] 팝업 1차 고도화 요소가 반영되어 정보 위계가 보인다(하이라이트·배지·카드형 표·㎡ 병기·위험 요약).
- [ ] 상단 행동 버튼(공유/인쇄/즐겨찾기)의 상태 저장/토스트 처리.
- [ ] 비교/즐겨찾기 등 행동 버튼의 비즈니스 연계.

## 의존성/리스크

- Kakao JS 키 도메인 허용 목록 재확인 필요(로컬/개발/운영). 도메인 미허용 시 403 위험.
- 향후 `libraries=services,clusterer` 사용 시 스크립트 파라미터 관리 필요.
- 대량 마커 시 성능 이슈 가능(클러스터링/가상화 고려).

## 참고 파일

- `Application/components/features/map-view.tsx`
- `Application/lib/map/kakaoLoader.ts`
- `.env.local` (로컬), 배포 ENV: Amplify 환경변수
- 문서: `Doc/FRONTEND_ARCHITECTURE.md`, `README.md`

## 진행 현황(%)

- 지도 전환/렌더 안정화: 100%
- 지역 선택 → 데이터/마커 표시: 0%
- 목록-지도 상호작용/센터 동기화: 0%
- 종합 진행률(오늘 범위): 40%

## 다음에 할 일 (Next Steps)

1. 팝업 UI 2차 정렬: 섹션 순서/강조 톤 재배치(요청 반영) – 상단 핵심 KPI → 위험/유의 → 기본/시설 → 기타.
2. 카드 요약치에 서브메타(아이콘/툴팁/단위) 추가 및 라벨 축약(스캔성 개선).
3. 특수권리 문구 토큰화 및 위험 키워드 하이라이트(색상/밑줄/아이콘).
4. 상단 액션(공유/인쇄/즐겨찾기) 상태 유지(localStorage) 및 토스트 메시지.
5. 인쇄용 레이아웃(CSS @media print) 최적화.
6. 지도 작업은 보류(요청사항) – 추후 스펙 확정 시 진행.

## 커뮤니케이션(요청/응답)

- 파이프라인 팀에 아래 요청서 발송(사양 공유 요청):
  - 경로: `Communication/Pipeline/send/Request/250823_Frontend_to_Pipeline_Auction_ing_지도_마커_레전드_팝업_사양_공유_요청.md`
  - 요청 내용: 마커 분류/색상, 레전드 항목, 팝업 필드/포맷, 클러스터링 규칙, 성능/이벤트 정책, 좌표/데이터 스키마, 샘플 자료.
  - 일정 제안: D+1 사양 수신 → D+3 마커/레전드 1차 → D+5 데이터 연동.

## 참고: Kakao 지도 가이드 핵심 포인트(요약)

- SDK 로딩: `autoload=false` 후 `kakao.maps.load(cb)` 패턴 권장.
- 마커/오버레이: `kakao.maps.Marker`, `kakao.maps.CustomOverlay` 사용.
- 클러스터링: `libraries=clusterer` 추가 후 `kakao.maps.MarkerClusterer` 활용.
- 이벤트: `kakao.maps.event.addListener(target, 'click', handler)`.
- 리레이아웃: 컨테이너 크기 변경 시 `map.relayout()` + 기존 `center` 복원.
