# [긴급] Locations API 빈 데이터 반환 문제 해결 요청

**문서 ID**: 250120*Frontend_to_Backend_Locations_API*빈데이터*문제해결*요청  
**작성일**: 2025-01-20  
**작성자**: Frontend Team  
**수신**: Backend Team  
**우선순위**: 🔴 긴급 (High)  
**관련 API**: `/api/v1/locations/tree-simple`

---

## 📋 문제 현황

### ❌ **현재 상태**

- **API 엔드포인트**: `GET http://127.0.0.1:8001/api/v1/locations/tree-simple`
- **응답 코드**: `200 OK` ✅
- **응답 데이터**: **빈 데이터 반환 중** ❌

```json
{
  "provinces": [],
  "cities": {},
  "districts": {}
}
```

### ✅ **기대 결과**

17개 시도를 포함한 완전한 주소 트리 데이터:

```json
{
  "provinces": [
    "서울특별시", "부산광역시", "대구광역시", "인천광역시",
    "광주광역시", "대전광역시", "울산광역시", "세종특별자치시",
    "경기도", "강원도", "충청북도", "충청남도",
    "전라북도", "전라남도", "경상북도", "경상남도", "제주특별자치도"
  ],
  "cities": {
    "서울특별시": ["강남구", "서초구", "송파구", "강서구", ...],
    "경기도": ["수원시", "성남시", "안양시", "부천시", ...],
    ...
  },
  "districts": {
    "강남구": ["역삼동", "삼성동", "청담동", "압구정동", ...],
    "수원시": ["팔달구", "영통구", "장안구", "권선구"],
    ...
  }
}
```

---

## 🔍 **Frontend 진단 결과**

### **API 호출 상태**

- ✅ **연결**: 정상 (200 OK)
- ✅ **요청 URL**: `http://127.0.0.1:8001/api/v1/locations/tree-simple`
- ✅ **응답 수신**: 정상
- ❌ **데이터 내용**: 빈 배열/객체

### **Frontend 로그**

```javascript
// 실제 콘솔 출력
🔍 useLocationsSimple 상태: {
  hasData: true,
  hasError: false,
  isLoading: false,
  hasValidBackendData: false,  // ← 문제!
  backendProvincesCount: 0     // ← 문제!
}

📋 백엔드 원본 응답 데이터: {
  "provinces": [],    // ← 빈 배열
  "cities": {},       // ← 빈 객체
  "districts": {}     // ← 빈 객체
}
```

### **현재 Frontend 대응**

- 🔄 **임시 데이터 사용**: 5개 시도 (서울, 경기, 인천, 부산, 대구)
- ⚠️ **사용자 알림**: "백엔드 서버에서 빈 데이터를 반환하고 있어서 임시 데이터로 대체 중입니다."

---

## 🛠️ **Backend 확인 요청사항**

### 1️⃣ **데이터베이스 확인**

```sql
-- 주소 데이터 존재 여부 확인
SELECT COUNT(*) FROM locations WHERE type = 'sido';
SELECT name FROM locations WHERE type = 'sido' LIMIT 5;
```

**기대값**:

- 시도 데이터: 17건
- 시군구 데이터: 200+건
- 읍면동 데이터: 3000+건

### 2️⃣ **API 엔드포인트 테스트**

```bash
# 로컬 테스트
curl -X GET "http://127.0.0.1:8001/api/v1/locations/tree-simple" \
     -H "Accept: application/json" \
     -H "Content-Type: application/json"
```

**확인사항**:

- 응답 코드가 200인가?
- JSON 형식이 올바른가?
- provinces 배열에 데이터가 있는가?

### 3️⃣ **Backend 로직 확인**

```python
# locations/tree-simple 엔드포인트 확인 사항
def get_locations_tree_simple():
    # 1. 데이터베이스 쿼리가 정상 실행되는가?
    # 2. 데이터 직렬화가 올바른가?
    # 3. 빈 결과를 반환하는 조건이 있는가?
    # 4. 예외 처리에서 빈 데이터를 반환하는가?
```

### 4️⃣ **환경/설정 확인**

- **데이터베이스 연결**: 정상인가?
- **테이블 스키마**: 올바른가?
- **데이터 적재**: 완료되었는가?
- **권한/접근**: 문제없는가?

---

## ⚡ **즉시 확인 가능한 디버깅 체크리스트**

### **Step 1: 데이터 존재 확인**

```bash
# 데이터베이스 직접 확인
- [ ] 시도 테이블에 17개 데이터 존재
- [ ] 시군구 테이블에 200+ 데이터 존재
- [ ] 읍면동 테이블에 3000+ 데이터 존재
```

### **Step 2: API 직접 테스트**

```bash
# Backend 서버에서 직접 실행
curl localhost:8001/api/v1/locations/tree-simple

# 기대 결과: provinces 배열에 17개 시도
```

### **Step 3: 로그 확인**

```bash
# Backend 서버 로그에서 확인
- [ ] API 호출 로그 존재
- [ ] 쿼리 실행 로그 확인
- [ ] 에러/예외 로그 없음
- [ ] 응답 데이터 로그 확인
```

### **Step 4: 코드 로직 확인**

```python
# locations/tree-simple 함수에서
- [ ] 데이터베이스 쿼리문 정상
- [ ] 결과 데이터 직렬화 정상
- [ ] 예외 처리에서 빈 데이터 반환하지 않음
- [ ] 필터링 조건에서 모든 데이터 제외하지 않음
```

---

## 📞 **연락 및 진행사항**

### **즉시 대응 요청**

1. **1시간 내**: 현황 확인 및 원인 파악
2. **4시간 내**: 문제 해결 및 정상 데이터 응답
3. **당일 내**: 최종 테스트 및 확인 완료

### **중간 보고**

- 📧 **이메일**: 1시간 단위 진행상황 공유
- 💬 **슬랙**: 실시간 소통 채널 활용
- 📋 **문서**: 해결 과정 Communication 폴더에 기록

### **테스트 협조**

Frontend에서 다음 시나리오로 즉시 테스트 가능:

1. API 응답 데이터 확인
2. 드롭다운에 17개 시도 표시 확인
3. 시군구/읍면동 연쇄 선택 테스트
4. 실제 매물 필터링 동작 확인

---

## 🎯 **성공 기준**

### **✅ 해결 완료 조건**

1. **API 응답**: provinces 배열에 17개 시도 데이터
2. **Frontend 화면**: 시도명 드롭다운에 17개 시도 표시
3. **연쇄 필터**: 시도→시군구→읍면동 선택 정상 작동
4. **데이터 품질**: 실제 행정구역 데이터와 일치
5. **응답 속도**: 500ms 이하 유지

### **🔍 최종 검증**

```bash
# 성공 응답 예시
{
  "provinces": [
    "서울특별시", "부산광역시", ..., "제주특별자치도"  // 17개
  ],
  "cities": {
    "서울특별시": ["강남구", "서초구", ...],      // 25개
    "경기도": ["수원시", "성남시", ...]           // 31개
  },
  "districts": {
    "강남구": ["역삼동", "삼성동", ...]           // 실제 법정동
  }
}
```

---

## 💡 **추가 개선 제안**

### **데이터 품질**

- 🏷️ **코드 포함**: 행정구역 코드 추가 (향후 필요)
- 📊 **매물 수량**: 각 지역별 매물 개수 포함 (옵션)
- ⚡ **캐싱**: 응답 속도 최적화

### **모니터링**

- 📈 **헬스체크**: `/health` 엔드포인트로 데이터 상태 확인
- 🚨 **알림**: 빈 데이터 응답 시 자동 알림
- 📝 **로깅**: API 호출 및 응답 데이터 로깅 강화

---

**감사합니다. 빠른 해결 부탁드립니다!** 🙏

**Frontend Team**  
**연락처**: [Frontend 담당자 연락처]  
**작성일시**: 2025-01-20 현재

---

## ✅ 백엔드 회신 (완료)

- 현상 재현 및 원인

  - `http://127.0.0.1:8001/api/v1/locations/tree-simple`는 200 OK이나 빈 구조를 반환
  - 8001 포트 인스턴스가 DB 미연결/오환경으로 인해 `tree-simple`의 예외 폴백(빈 구조)이 동작함
  - 8000 포트 인스턴스는 정상(DB 연결 및 데이터 적재 완료)으로 비어있지 않은 트리를 반환

- 조치

  - 8001 인스턴스 종료(혼선 제거), 8000 인스턴스만 사용하도록 표준화
  - 검증: `curl http://127.0.0.1:8000/api/v1/locations/tree-simple` → 200 OK, provinces 다수 반환

- 프론트 적용 지시

  - `.env.local`: `NEXT_PUBLIC_API_BASE_URL=http://127.0.0.1:8000`
  - 초기 로드: `GET /api/v1/locations/tree-simple`
  - 단계 로드(선택): `/locations/sido` → `/locations/cities` → `/locations/towns`

- 빠른 자체 테스트

  - `curl http://127.0.0.1:8000/api/v1/locations/sido`
  - `curl "http://127.0.0.1:8000/api/v1/items/simple?sido=경기도&city=수원시&minPrice=2000&maxPrice=6000"`

- 비고

  - `tree-simple`은 현재 인벤토리 기반 트리(실데이터 존재 지역) 반환 설계이며, 전체 17개 시도 상시 고정 제공은 요구사항 변경에 해당합니다(필요 시 옵션화 가능).

- 상태: Done
