## [요청] 실거래가(전월세) 선택 항목만 보기(ids) 서버 필터 지원 요청 (251011)

### 1) 배경/문제

- 프론트는 목록 테이블 체크박스 기반으로 "선택 항목만 보기" UX를 제공해야 합니다.
- 매매(real-transactions)는 `ids` 서버 필터를 통해 대용량에서도 안정/일관 동작합니다.
- 전월세(real-rents)는 현재 프론트에서 임시로 클라이언트 필터(선택된 id만 표시)를 적용했으나, 성능/일관성을 위해 매매와 동일하게 서버 `ids` 필터가 필요합니다.

### 2) 대상 API

- GET `/api/v1/real-rents/`

### 3) 요청 파라미터 사양(신규)

- `ids`: CSV 문자열, 예) `"1,2,3"`
  - 타입: 문자열(내부적으로 id는 숫자 또는 문자열 키를 허용)
  - 최대 개수: 500개(초과 시 에러 반환)
  - 중복: 서버에서 dedup 처리
  - 무효 id: 무시(존재하는 id만 필터), 전체가 무효면 빈 결과
- 결합 동작: 다른 필터와 AND 교집합으로 동작(지역/금액/면적/날짜/층확인/엘리베이터 등)

### 4) 정렬/페이징 정책(기존 준수)

- `ordering`과 함께 사용 가능. 예) `ordering=-contract_date`
- 결정적 정렬 유지: 동률 시 `id` tie-breaker 적용(기존 정책 유지)
- `count`/`total`는 ids 필터와 다른 조건을 모두 적용한 뒤의 개수로 반환

### 5) 에러 정책

- 형식 오류(예: 공백/허용되지 않는 구분자/비정상 문자열): 400 Bad Request
- 개수 초과(>500): 400 또는 413(정책에 맞춰 선택)과 명확한 메시지
- 기타 서버 오류: 기존 정책 준수

### 6) 성능 고려사항

- `id` 인덱스 사용을 가정합니다(단일/복합 인덱스 상관없음). CSV를 파싱하여 IN 쿼리로 최적화해주세요.
- 다른 필터와 결합 시에도 실행 계획이 과도하게 느려지지 않도록 점검 부탁드립니다.

### 7) 예시(curl)

```bash
curl -G "http://127.0.0.1:8000/api/v1/real-rents/" \
  --data-urlencode "sido=서울특별시" \
  --data-urlencode "sigungu=서울특별시 강남구" \
  --data-urlencode "ids=101,205,333,444" \
  --data-urlencode "ordering=-contract_date" \
  --data-urlencode "page=1" \
  --data-urlencode "size=20"
```

### 8) 프론트 연동 현황

- 프론트는 이미 `showSelectedOnly===true`이고 `selectedIds`가 있을 때 `ids`를 CSV로 전송하도록 구성했습니다.
  - 위치: `Application/datasets/registry.ts` (`rent.api.buildListKey`/`fetchList`)
- 서버가 지원 즉시, 대용량에서도 선택 전용 보기 기능이 일관/고성능으로 동작합니다.
- 안전장치: 서버 미지원/일시 오류 시에도 UI가 동작하도록 클라이언트 필터(선택 id만 표시)를 병행 유지합니다.

### 9) 수용 기준(AC)

- AC1: `ids` 파라미터를 수신하여 해당 id들만 필터링(다른 파라미터와 AND 결합) 후 200 OK
- AC2: `ids` 빈/부재 시 기존 동작 유지, 일부 무효 id는 무시
- AC3: `ordering`/페이징과 결합 시 일관된 결과 및 결정적 정렬 보장
- AC4: `count`/`results`(또는 `items`)가 조건에 맞게 정확히 반환
- AC5: 최대 500개 초과 시 에러를 일관되게 반환(명확한 메시지 포함)

### 10) 롤아웃/검증

- 브랜치: `feat/real-rents-v2-ids`
- 프론트 통합 테스트 체크리스트:
  - 선택 항목만 보기 ON/OFF 시 `ids` 전송/해제 확인
  - 지역/날짜/금액 등과 결합 시 결과 일관성
  - 정렬/페이징과 결합 시 결정적 정렬 보장

### 11) 문의

- 프론트 담당: FE team (실거래가 v2)
- 참고: 기 확장 답신서(251011)와 동일 엔드포인트 내에서의 추가 파라미터입니다.
