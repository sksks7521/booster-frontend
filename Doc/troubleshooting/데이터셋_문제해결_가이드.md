# 🚨 **데이터셋 문제 해결 가이드**

## 📋 **개요**

- **목적**: 데이터셋 관련 주요 문제와 해결 방법 제시
- **범위**: API 응답, 컬럼 매핑, 데이터 표시 문제
- **대상**: 프론트엔드 개발자, 유지보수 담당자
- **최종 업데이트**: 2025-08-31

---

## 🔥 **긴급 문제 해결 체크리스트**

### **⚡ 1분 내 확인사항**

- [ ] 개발서버 정상 실행 중인가?
- [ ] 브라우저 콘솔에 에러 없는가?
- [ ] API 서버 응답 중인가?
- [ ] 네트워크 탭에서 API 호출 성공했는가?

### **⚡ 5분 내 확인사항**

- [ ] 백엔드 서버 상태 정상인가?
- [ ] API 응답 데이터 구조 변경됐는가?
- [ ] 최근 코드 변경사항 있는가?
- [ ] 캐시 문제인가?

---

## 🔧 **주요 문제별 해결 방법**

## **Problem 1: 테이블에 "-" 만 표시됨**

### **🔍 증상**

```
테이블 컬럼에 실제 데이터 대신 "-" 만 표시
백엔드 API는 정상 응답하지만 프론트엔드에서 인식 못함
```

### **💡 해결 순서**

#### **1단계: API 응답 확인**

```javascript
// 브라우저 콘솔에서 실행
fetch("http://127.0.0.1:8000/api/v1/real-transactions/?page=1&size=1")
  .then((response) => response.json())
  .then((data) => {
    console.log("📊 API 응답 구조:", data);
    console.log("📈 첫 번째 아이템:", data.items?.[0] || data.results?.[0]);
    console.log(
      "🔢 필드 개수:",
      Object.keys(data.items?.[0] || data.results?.[0] || {}).length
    );
  });
```

#### **2단계: 컬럼 설정 확인**

```typescript
// Application/datasets/registry.ts 확인
const config = registry[datasetId];
console.log("🎯 컬럼 설정:", config.table.columns);

// ❌ 잘못된 경우
auction_ed: {
  table: {
    columns: columnsSale;
  } // 실거래가용 컬럼을 경매결과에 사용
}

// ✅ 올바른 경우
auction_ed: {
  table: {
    columns: columnsAuctionEd;
  } // 경매결과용 컬럼 사용
}
```

#### **3단계: getValueForKey 함수 확인**

```typescript
// 컴포넌트에서 데이터 접근 방식 확인
function getValueForKey(row, key) {
  const value = row?.[key] || row?.extra?.[key];
  console.log(`🔑 Key: ${key}, Value: ${value}`);
  return value || "-";
}
```

#### **4단계: 스키마 검증 우회**

```typescript
// Application/datasets/schemas.ts
if (datasetId === "auction_ed") {
  console.log("✅ [validateRow] auction_ed 우회");
  return row; // 모든 데이터 통과
}
```

---

## **Problem 2: API 응답과 프론트엔드 기대 포맷 불일치**

### **🔍 증상**

```
백엔드: { items: [], total_items: 1000 }
프론트엔드: { results: [], count: 1000 } 기대
총 건수가 0으로 표시되거나 데이터가 로드되지 않음
```

### **💡 해결 방법**

#### **1단계: API 클라이언트 수정**

```typescript
// Application/lib/api.ts
export async function getRealTransactions(params) {
  const response = await fetch(url);
  const data = await response.json();

  // ✅ 응답 포맷 변환
  return {
    results: data.items, // 백엔드 → 프론트엔드 매핑
    count: data.total_items, // 백엔드 → 프론트엔드 매핑
  };
}
```

#### **2단계: useDataset 훅 호환성 보장**

```typescript
// Application/hooks/useDataset.ts
const rawItemsAll = data?.results || data?.items || [];
const total = data?.count || data?.total || 0;
```

---

## **Problem 3: 개발서버 캐시 문제**

### **🔍 증상**

```
백엔드에서 API 수정 완료했다고 하는데
프론트엔드에서는 여전히 이전 데이터 표시
```

### **💡 해결 방법**

#### **1단계: 프로세스 완전 종료**

```powershell
# 모든 Node.js 프로세스 종료
taskkill /F /IM node.exe

# 또는 특정 포트 프로세스 종료
netstat -ano | findstr :3000
taskkill /F /PID [PID번호]
```

#### **2단계: 캐시 삭제**

```powershell
# npm 캐시 삭제
npm cache clean --force

# Next.js 캐시 삭제
rm -rf Application/.next
```

#### **3단계: 서버 재시작**

```powershell
cd Application
npm run dev
```

#### **4단계: 브라우저 캐시 삭제**

```
Chrome/Edge:
1. Ctrl + Shift + Delete
2. "전체 기간" 선택
3. "캐시된 이미지 및 파일" 체크
4. "삭제" 클릭
```

---

## **Problem 4: 컬럼 개수는 많은데 실제 데이터 없음**

### **🔍 증상**

```
API 응답에서 필드는 57개인데
실제 값이 있는 필드는 11개만
나머지는 모두 null 또는 undefined
```

### **💡 해결 방법**

#### **1단계: 백엔드 실제 구현 확인**

```javascript
// 실제 제공 필드 vs null 필드 분석
fetch("http://127.0.0.1:8000/api/v1/real-transactions/?page=1&size=10")
  .then((response) => response.json())
  .then((data) => {
    const firstItem = data.items[0];
    const fieldsWithData = [];
    const fieldsWithNull = [];

    Object.entries(firstItem).forEach(([key, value]) => {
      if (value !== null && value !== undefined && value !== "") {
        fieldsWithData.push(key);
      } else {
        fieldsWithNull.push(key);
      }
    });

    console.log("✅ 데이터 있는 필드:", fieldsWithData);
    console.log("❌ null/빈 필드:", fieldsWithNull);
    console.log(
      `📊 실제 데이터율: ${fieldsWithData.length}/${
        Object.keys(firstItem).length
      }`
    );
  });
```

#### **2단계: 백엔드 요청서 작성**

```markdown
# 백엔드 요청서 템플릿

## 문제 상황

- API 응답: 57개 필드 제공
- 실제 데이터: 11개 필드만 값 존재
- 누락 필드: 46개 필드가 null

## 요청 사항

1. 실제 데이터베이스에서 해당 필드들 조회 가능한지 확인
2. JOIN 필요한 테이블이 있는지 확인
3. 계산 필드의 경우 로직 구현 필요
4. 일정 안내 요청

## 검증 방법

[검증 스크립트 제공]
```

#### **3단계: 프론트엔드 임시 대응**

```typescript
// 실제 데이터 있는 필드만 표시 (임시)
const columnsWithData = allColumns.filter((col) => {
  // 실제 데이터 체크 로직
  return hasActualData(sampleData, col.key);
});
```

---

## **Problem 5: 지역 필터링 동작 안함**

### **🔍 증상**

```
지역 드롭다운 선택했는데 테이블 데이터가 필터링 안됨
API 호출은 되지만 전체 데이터 그대로 표시
```

### **💡 해결 방법**

#### **1단계: API 파라미터 매핑 확인**

```typescript
// Application/datasets/registry.ts
const mappedFilters = { ...allowedFilters };
if (filters?.province) {
  mappedFilters.sido = filters.province; // 프론트엔드 → 백엔드 매핑
  delete mappedFilters.province;
}
```

#### **2단계: 백엔드 필터링 미지원시 클라이언트 필터링**

```typescript
// 클라이언트에서 필터링 구현
const filteredItems = rawItems.filter((item) => {
  if (filters.province && item.extra?.sido !== filters.province) {
    return false;
  }
  return true;
});
```

#### **3단계: 필터 상태 디버깅**

```typescript
console.log("🎯 Filter State:", {
  province: filters.province,
  cityDistrict: filters.cityDistrict,
  mappedToAPI: mappedFilters,
});
```

---

## **Problem 6: SWR 캐시 에러**

### **🔍 증상**

```
Error: SWR error: {key: "@\"analysis\",\"column_order\",\"user-preferences\","...}
API 호출이 실패하면서 데이터 로드 안됨
```

### **💡 해결 방법**

#### **1단계: 에러 핸들링 강화**

```typescript
// Application/hooks/useColumnOrder.ts
const { data, error } = useSWR(key, fetcher, {
  onError: (error) => {
    if (error.status === 401 || error.message?.includes("Failed to fetch")) {
      console.warn("⚠️ Column order API unavailable, using defaults");
      return; // 에러 무시하고 기본값 사용
    }
    console.error("❌ Column order error:", error);
  },
});
```

#### **2단계: 기본값 fallback**

```typescript
const columnOrder = error ? defaultColumnOrder : data || defaultColumnOrder;
```

---

## 📊 **문제 진단 도구**

### **1. API 상태 확인 스크립트**

```javascript
// 브라우저 콘솔에서 실행
async function diagnosisDatasetAPI(datasetId) {
  const endpoints = {
    auction_ed: "/api/v1/auction-completed/",
    real_transactions: "/api/v1/real-transactions/",
    real_rents: "/api/v1/real-rents/",
  };

  const url = `http://127.0.0.1:8000${endpoints[datasetId]}?page=1&size=1`;

  try {
    const response = await fetch(url);
    const data = await response.json();
    const firstItem = data.items?.[0] || data.results?.[0];

    console.log(`📊 ${datasetId} 진단 결과:`);
    console.log(`  - 상태: ${response.status}`);
    console.log(`  - 총 건수: ${data.total_items || data.count}`);
    console.log(`  - 필드 개수: ${Object.keys(firstItem).length}`);
    console.log(`  - 응답 구조:`, Object.keys(data));
    console.log(`  - 첫 번째 아이템:`, firstItem);

    return { status: "ok", fieldCount: Object.keys(firstItem).length };
  } catch (error) {
    console.error(`❌ ${datasetId} 에러:`, error);
    return { status: "error", error };
  }
}

// 사용 예시
diagnosisDatasetAPI("real_transactions");
```

### **2. 컬럼 매핑 검증 스크립트**

```javascript
// registry 설정 vs 실제 API 응답 비교
function validateColumnMapping(datasetId) {
  const config = window.__DEBUG_REGISTRY?.[datasetId];
  if (!config) {
    console.error("❌ Registry config not found");
    return;
  }

  console.log("🔍 컬럼 매핑 검증:", datasetId);
  console.log("  - 설정된 컬럼:", config.table.columns.length);
  console.log(
    "  - 컬럼 정의:",
    config.table.columns.map((c) => c.key)
  );
}
```

---

## 🚀 **예방 조치**

### **1. 정기 점검 항목**

- [ ] **주간**: API 응답 필드 개수 확인
- [ ] **월간**: 스키마 정합성 검증
- [ ] **릴리즈 전**: 전체 데이터셋 시연 테스트

### **2. 모니터링 설정**

```typescript
// API 응답 필드 수 모니터링
function monitorFieldCount(datasetId, expectedCount) {
  if (actualCount < expectedCount * 0.8) {
    console.warn(`⚠️ ${datasetId}: 필드 수 감소 감지`);
    // 알람 발송 로직
  }
}
```

### **3. 자동화된 테스트**

```typescript
// E2E 테스트에 포함
test("모든 데이터셋 필드 정상 표시", async () => {
  const datasets = ["auction_ed", "real_transactions", "real_rents"];

  for (const datasetId of datasets) {
    await page.click(`[data-testid="${datasetId}-tab"]`);
    await page.waitForSelector("table");

    const nonEmptyCells = await page.$$eval(
      "td",
      (cells) => cells.filter((cell) => cell.textContent.trim() !== "-").length
    );

    expect(nonEmptyCells).toBeGreaterThan(0);
  }
});
```

---

## 📞 **에스컬레이션 가이드**

### **1. 프론트엔드 이슈**

1. **즉시**: 개발자 도구 콘솔 에러 확인
2. **5분 내**: 최근 코드 변경사항 롤백 시도
3. **15분 내**: 캐시 클리어 및 서버 재시작
4. **30분 내**: Tech Lead 에스컬레이션

### **2. 백엔드 이슈**

1. **즉시**: API 상태 확인 (status, response time)
2. **10분 내**: 백엔드팀 Slack 채널 문의
3. **30분 내**: 상세한 요청서 작성 및 전달
4. **1시간 내**: 매니저 에스컬레이션

### **3. 긴급 상황 연락처**

- **Tech Lead**: [연락처]
- **Backend Lead**: [연락처]
- **DevOps**: [연락처]

---

## 📚 **관련 문서**

- [데이터셋 아키텍처](../DATASET_ARCHITECTURE.md)
- [API 개발 가이드](../Guides/API_DEVELOPMENT_GUIDE.md)
- [백엔드 통신 가이드](<../../Communication/COMMUNICATION_GUIDE(Frontend-Backend).md>)

---

**작성일**: 2025-08-31  
**최종 검토**: Tech Lead  
**다음 업데이트**: 문제 발생시 즉시 반영
