# 📋 페이지 수정 요구사항 분석 및 해결 방안

## 🎯 **11가지 수정 요청사항 분석**

---

### **1. 건물 유형 필터링 검증** ✅ **해결 완료**

#### 📊 **현재 상태**

- 현재 "다세대(빌라)" 데이터만 존재
- `buildingType` → `usage` 파라미터로 전송
- 백엔드에서 정상 필터링 지원 확인됨

#### 🔍 **문제 분석**

- 추후 다른 유형 (아파트, 오피스텔, 단독주택 등) 추가 시 필터링 오류 가능성
- 현재 단일 유형으로는 필터링 동작 확인 어려움

#### ✅ **해결 완료 - 실제 적용된 방법**

**1단계: useItems.ts 수정**

```typescript
// ✅ 실제 데이터에서 usage 고유값 동적 추출
const usageValues =
  items.length > 0 ? [...new Set(items.map((item: any) => item.usage))] : [];

// ✅ return 타입에 usageValues 추가
return {
  items,
  isLoading,
  error,
  totalCount,
  usageValues, // 🏢 동적 건물 유형 필터 옵션 생성용
  floorValues, // 🏢 동적 층확인 필터 옵션 생성용
  refetch: () => void mutate(),
  isRefreshing: isValidating,
};
```

**2단계: filter-control.tsx 수정**

```typescript
// ✅ useItems에서 실제 데이터 가져오기
const { usageValues } = useItems();

// ✅ 실제 데이터 기반 동적 필터 옵션 생성
const buildingTypeOptions = [
  { value: "all", label: "전체" },
  ...usageValues.map((usage) => ({
    value: usage,
    label: usage,
  })),
];

// ✅ 하드코딩된 옵션을 동적 옵션으로 교체
<ButtonGroup
  options={buildingTypeOptions}
  value={filters.buildingType || "all"}
  onChange={(value) => setFilter("buildingType", value)}
  disabled={buildingTypeOptions.length <= 1} // 데이터가 없으면 비활성화
/>;
```

**🎯 결과:**

- ✅ 현재: "다세대(빌라)" 옵션 정상 동작
- ✅ 추후: 아파트, 오피스텔 등 추가 시 자동으로 필터 옵션에 나타남
- ✅ 데이터 일치성: 실제 데이터와 필터 옵션 100% 일치 보장
- ✅ 확장성: 새로운 건물 유형 추가 시 코드 수정 없이 자동 대응

---

### **2. 슬라이더 형태로 변경 (가격범위, 면적범위, 건축년도)**

#### 📊 **현재 상태**

- 직접입력 형태의 spinbutton 사용
- 고정된 min/max 값 설정

#### 🔍 **문제 분석**

- 사용자 경험이 직관적이지 않음
- 범위 선택 시 불편함

#### 💡 **해결 방안**

1. **Shadcn/ui Slider 컴포넌트 사용**
2. **범위 슬라이더 구현** (dual-thumb slider)
3. **실시간 값 표시**

#### 🛠️ **구현 방법**

```tsx
import { Slider } from "@/components/ui/slider"

// 가격범위 슬라이더
<Slider
  defaultValue={[0, 500000]}
  max={500000}
  min={0}
  step={1000}
  className="w-full"
  onValueChange={(value) => setPriceRange(value)}
/>

// 면적범위 슬라이더
<Slider
  defaultValue={[0, 200]}
  max={200}
  min={0}
  step={1}
  onValueChange={(value) => setAreaRange(value)}
/>

// 건축년도 슬라이더
<Slider
  defaultValue={[1980, 2024]}
  max={2024}
  min={1980}
  step={1}
  onValueChange={(value) => setBuildYear(value)}
/>
```

---

### **3. 슬라이더 숫자 배경색 심플하게**

#### 📊 **현재 상태**

- 기본 Shadcn/ui 스타일 적용
- 배경색이 눈에 거슬림

#### 💡 **해결 방안**

1. **커스텀 CSS 클래스 추가**
2. **배경색 제거 또는 연한 색으로 변경**
3. **텍스트만 표시하거나 미니멀한 스타일 적용**

#### 🛠️ **구현 방법**

```css
.slider-value {
  background: transparent;
  color: #6b7280;
  font-size: 0.875rem;
  padding: 0.25rem 0.5rem;
  border: 1px solid #e5e7eb;
  border-radius: 0.375rem;
}
```

---

### **4. 키워드 검색 기능 확인**

#### 📊 **현재 상태**

- 검색 입력창과 "검색하기" 버튼 존재
- 실제 검색 로직 미구현

#### 🔍 **문제 분석**

- 검색 버튼 클릭 시 동작 없음
- 백엔드 API에 키워드 검색 파라미터 전송 미구현

#### 💡 **해결 방안**

1. **백엔드 키워드 검색 파라미터 확인**: `keyword` 또는 `search` 파라미터 지원 여부
2. **검색 로직 구현**: 주소, 법원, 사건번호 검색
3. **검색어 하이라이트 기능** (선택사항)

#### 🛠️ **구현 방법**

```typescript
// 1. 검색어 상태 추가
const [searchKeyword, setSearchKeyword] = useState("");

// 2. 검색 함수 구현
const handleSearch = () => {
  setFilter("keyword", searchKeyword);
};

// 3. API 파라미터 추가
if (filters.keyword && filters.keyword.trim()) {
  params.keyword = filters.keyword.trim();
}
```

---

### **5. 지역 선택 전 데이터 로딩 방지**

#### 📊 **현재 상태**

- 지역 선택 없이도 전체 데이터 로딩
- 성능상 비효율적

#### 💡 **해결 방안**

1. **조건부 데이터 fetching**: 지역 선택 시에만 API 호출
2. **로딩 상태 개선**: 지역 미선택 시 안내 메시지
3. **성능 최적화**

#### 🛠️ **구현 방법**

```typescript
// useItems.ts 수정
export function useItems(): UseItemsResult {
  const filters = useFilterStore();

  // 지역이 선택되지 않았으면 API 호출 안 함
  const shouldFetch = filters.cityDistrict && filters.cityDistrict !== "all";

  const { data, error, isLoading } = useSWR(
    shouldFetch ? ["/api/v1/items/custom", filters] : null,
    fetcher
  );

  if (!shouldFetch) {
    return {
      items: [],
      totalCount: 0,
      isLoading: false,
      error: null,
    };
  }

  // ... 나머지 로직
}
```

---

### **6. '현재 조건으로 약 XXX개 매물 검색' 텍스트 제거**

#### 📊 **현재 상태**

- 상세 조건 설정 하단에 예상 검색 결과 수 표시
- 실제 검색 결과와 불일치 가능성

#### 💡 **해결 방안**

- 해당 텍스트 컴포넌트 제거

#### 🛠️ **구현 방법**

```tsx
// filter-control.tsx에서 제거
// <generic ref={e1412}>
//   <img ref={e1413} />
//   <generic ref={e1416}>
//     <text>현재 조건으로 약</text>
//     <generic ref={e1417}>"648"</generic>
//     <text>개의 매물이 검색됩니다</text>
//   </generic>
// </generic>
```

---

### **7. 테이블 컬럼 드래그앤드롭 순서 변경**

#### 📊 **현재 상태**

- 고정된 컬럼 순서
- 사용자 커스터마이징 불가

#### 💡 **해결 방안**

1. **React DnD 또는 dnd-kit 사용**
2. **컬럼 순서 상태 관리**
3. **로컬스토리지에 순서 저장**

#### 🛠️ **구현 방법**

```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

```tsx
import { DndContext, closestCenter } from "@dnd-kit/core";
import {
  SortableContext,
  horizontalListSortingStrategy,
} from "@dnd-kit/sortable";

// 컬럼 순서 상태
const [columnOrder, setColumnOrder] = useState([
  "usage",
  "case_number",
  "road_address", // ... 등
]);

// 드래그 끝났을 때
const handleDragEnd = (event) => {
  const { active, over } = event;
  if (active.id !== over.id) {
    setColumnOrder((items) => {
      const oldIndex = items.indexOf(active.id);
      const newIndex = items.indexOf(over.id);
      return arrayMove(items, oldIndex, newIndex);
    });
  }
};
```

---

### **8. 서버 사이드 정렬 구현**

#### 📊 **현재 상태**

- 클라이언트 사이드에서 현재 페이지 데이터만 정렬
- 전체 데이터 기준 정렬 안 됨

#### 🔍 **문제 분석**

- 페이지네이션과 정렬이 따로 작동
- 사용자가 원하는 정렬 결과와 다름

#### 💡 **해결 방안**

1. **백엔드 정렬 파라미터 추가**: `sortBy`, `sortOrder`
2. **정렬 상태 관리**: 현재 정렬 컬럼과 방향 저장
3. **API 요청 시 정렬 파라미터 포함**

#### 🛠️ **구현 방법**

```typescript
// 정렬 상태 추가
const [sortConfig, setSortConfig] = useState({
  column: null,
  direction: "asc",
});

// API 파라미터에 정렬 정보 추가
if (sortConfig.column) {
  params.sortBy = sortConfig.column;
  params.sortOrder = sortConfig.direction;
}

// 컬럼 헤더 클릭 시 정렬
const handleSort = (column: string) => {
  setSortConfig((prev) => ({
    column,
    direction:
      prev.column === column && prev.direction === "asc" ? "desc" : "asc",
  }));
};
```

---

### **9. '확인불가' 데이터 표시 옵션 추가**

#### 📊 **현재 상태**

- 확인불가/NaN 값들이 필터링에서 제외됨
- 사용자가 이런 데이터도 보고 싶을 수 있음

#### 💡 **해결 방안**

1. **체크박스 옵션 추가**: "확인불가 데이터 포함"
2. **필터링 로직 수정**: 체크 시 null/undefined/NaN 값도 포함
3. **각 필터별 개별 적용** 또는 **전역 설정**

#### 🛠️ **구현 방법**

```tsx
// 체크박스 상태
const [includeUnknown, setIncludeUnknown] = useState(false);

// 필터링 로직 수정 (층확인 예시)
items = items.filter((item: any) => {
  const floorValue = item.floor_confirmation;

  // 확인불가 데이터 포함 옵션이 켜져있으면
  if (includeUnknown && (!floorValue || floorValue === "확인불가")) {
    return true;
  }

  return floorValue === filters.floorConfirmation;
});

// UI 추가
<div className="flex items-center space-x-2">
  <Checkbox checked={includeUnknown} onCheckedChange={setIncludeUnknown} />
  <label>확인불가 데이터도 표시</label>
</div>;
```

---

### **10. 면적 단위 통일 (㎡ → 평형)**

#### 📊 **현재 상태**

- 필터: ㎡ 단위
- 테이블: 평형 단위
- 단위 불일치로 사용자 혼란

#### 💡 **해결 방안**

1. **필터 라벨 변경**: "면적 범위 (㎡)" → "면적 범위 (평)"
2. **변환 로직 추가**: ㎡ ↔ 평 변환 (1평 = 3.3㎡)
3. **백엔드 API 확인**: 평형 단위로 필터링 가능한지 확인

#### 🛠️ **구현 방법**

```typescript
// 변환 함수
const sqmToPyeong = (sqm: number) => Math.round((sqm / 3.3) * 100) / 100;
const pyeongToSqm = (pyeong: number) => Math.round((pyeong * 3.3) * 100) / 100;

// 필터 값을 평형으로 표시
<Slider
  defaultValue={[0, 60]} // 200㎡ = 약 60평
  max={60}
  min={0}
  step={0.1}
  onValueChange={(value) => {
    // 내부적으로는 ㎡로 변환해서 저장
    const sqmValue = value.map(pyeongToSqm);
    setAreaRange(sqmValue);
  }}
/>

// 라벨 변경
<label>면적 범위 (평)</label>
```

---

### **11. 상세 조건 설정 레이아웃 2줄로 변경**

#### 📊 **현재 상태**

```
가격범위 | 면적범위 | 건축년도
```

#### 💡 **목표 레이아웃**

```
가격범위 | 건축년도
건축면적범위 | 토지면적범위
```

#### 🛠️ **구현 방법**

```tsx
// 기존 3개를 2줄로 재배치
<div className="space-y-4">
  {/* 첫 번째 줄 */}
  <div className="grid grid-cols-2 gap-4">
    <div>
      {/* 가격범위 */}
      <PriceRangeSlider />
    </div>
    <div>
      {/* 건축년도 */}
      <BuildYearSlider />
    </div>
  </div>

  {/* 두 번째 줄 */}
  <div className="grid grid-cols-2 gap-4">
    <div>
      {/* 건축면적범위 */}
      <BuildingAreaSlider />
    </div>
    <div>
      {/* 토지면적범위 */}
      <LandAreaSlider />
    </div>
  </div>
</div>
```

---

## 🚀 **구현 우선순위**

### **Phase 1: 기본 기능 수정**

1. ✅ 지역 선택 전 데이터 로딩 방지 (5번)
2. ✅ 예상 검색 결과 텍스트 제거 (6번)
3. ✅ 면적 단위 통일 (10번)
4. ✅ 레이아웃 2줄로 변경 (11번)

### **Phase 2: 사용자 경험 개선**

5. ✅ 슬라이더 형태로 변경 (2번)
6. ✅ 슬라이더 스타일 개선 (3번)
7. ✅ 건물 유형 필터링 검증 (1번)
8. ✅ 키워드 검색 기능 (4번)

### **Phase 3: 고급 기능**

9. ✅ '확인불가' 데이터 표시 옵션 (9번)
10. ✅ 서버 사이드 정렬 (8번)
11. ✅ 컬럼 드래그앤드롭 (7번)

---

## 📝 **추가 고려사항**

### **성능 최적화**

- 슬라이더 onChange 이벤트 디바운싱
- 서버 사이드 정렬 시 캐싱 고려
- 큰 데이터셋에서의 클라이언트 사이드 필터링 성능

### **사용자 경험**

- 필터 변경 시 로딩 상태 표시
- 에러 상황에 대한 적절한 안내 메시지
- 모바일 반응형 디자인 고려

### **데이터 일관성**

- 백엔드 API와의 파라미터 명세 일치 확인
- 실제 데이터 형식에 맞는 필터링 로직
- 단위 변환의 정확성 확보

---

---

## 🚨 **추가 요구사항 (Phase 1 검증 후 발견된 문제들)**

### **A. 지역 선택 로직 수정** ⚠️ **중요**

#### 📊 **현재 문제 상황**

- 시도명만 선택해도 검색 결과가 표시됨
- 이는 성능상 좋지 않고 사용자 경험도 좋지 않음

#### 💡 **해결 방안**

- **시도명 + 시군구 모두 선택된 경우에만** 검색 결과 표시
- 시도명만 선택된 상태에서는 "시군구를 선택해주세요" 안내 표시

#### 🛠️ **구현 방법**

```typescript
// useItems.ts에서 지역 선택 완료 조건 수정
const hasLocationSelected = selectedProvince && selectedCity;

if (!hasLocationSelected) {
  return {
    items: [],
    isLoading: false,
    // ...
  };
}
```

---

### **B. 키워드 검색 기능 재구현** ⚠️ **중요**

#### 📊 **현재 문제 상황**

- 키워드 검색이 실제로는 작동하지 않음
- 검색 범위가 명확하지 않음

#### 💡 **해결 방안**

1. **검색 필드 선택 기능 추가**

   - 사건번호로 검색
   - 도로명주소로 검색
   - 전체 검색 (기본값)

2. **실제 키워드 검색 기능 구현**
   - 백엔드 API 파라미터 정확히 전송
   - 검색 결과 즉시 반영

#### 🛠️ **구현 방법**

```typescript
// 1. 검색 필드 선택 드롭다운 추가
const searchFields = [
  { value: "all", label: "전체" },
  { value: "case_number", label: "사건번호" },
  { value: "road_address", label: "도로명주소" },
];

// 2. 검색 파라미터 개선
if (filters.searchQuery && filters.searchField) {
  if (filters.searchField === "all") {
    params.search = filters.searchQuery;
  } else {
    params[`search_${filters.searchField}`] = filters.searchQuery;
  }
}
```

---

## 📊 **수정된 우선순위**

### **🔥 긴급 수정 (즉시 처리 필요)**

- **A. 지역 선택 로직 수정** - 성능 및 UX 개선
- **B. 키워드 검색 기능 재구현** - 핵심 기능 정상화

### **📋 이후 진행 예정**

- **Phase 2**: 사용자 경험 개선 (슬라이더, 면적 단위, 레이아웃)
- **Phase 3**: 고급 기능 (컬럼 정렬, 드래그앤드롭, 확인불가 옵션)

---

**🎯 총 예상 작업 시간: 10-14시간** (긴급 수정 2시간 추가)
**📅 수정된 진행 순서: 긴급 수정 → Phase 2 → Phase 3**

---

## 🚨 **추가 요구사항 C & D** (2025.08.21 발견)

### **🔥 긴급 수정 C: 서버 사이드 정렬 오작동 문제**

#### **문제 현황:**

- **경기도 고양시**에서 **감정가 오름차순** 정렬 버튼 클릭 시 반응 없음
- 서울 강남구에서는 정상 작동했으나, 다른 지역에서 오작동 발생
- 서버 사이드 정렬이 일부 지역에서 제대로 동작하지 않는 상황

#### **예상 원인:**

1. **백엔드 API 지역별 정렬 지원 차이**
2. **정렬 파라미터 전송 오류** (특정 지역 조건에서)
3. **데이터 스키마 불일치** (지역별 데이터 구조 상이)

#### **해결 방안:**

1. **백엔드팀과 정렬 API 재검토** - 지역별 정렬 지원 여부 확인
2. **정렬 파라미터 디버깅** - 경기도 고양시 조건에서 전송되는 파라미터 점검
3. **폴백 메커니즘 구현** - 서버 정렬 실패시 클라이언트 정렬로 자동 전환

#### **우선순위:** 🔥 **높음** (핵심 기능 오작동)

---

### **🔥 긴급 수정 D: 클라이언트 사이드 필터링 개선**

#### **문제 현황:**

- **총 검색 결과 수 부정확**: 192건 중 탑층 필터 적용해도 여전히 "192건" 표시
- **페이지네이션 분산 문제**:
  - 1페이지: 탑층 2개, 2페이지: 탑층 4개
  - 탑층 필터 시 **연속으로 6개**가 1페이지에 나와야 하는데 **페이지별로 분산** 표시
- 사용자 경험 혼란: 실제 필터링된 개수와 표시된 개수 불일치

#### **예상 원인:**

1. **클라이언트 필터링 후 총 개수 미업데이트**
2. **서버 페이지네이션 + 클라이언트 필터링 충돌**
3. **층확인 필터가 클라이언트 사이드**로만 구현되어 있음

#### **해결 방안:**

**🎯 방안 1: 서버 사이드 필터링 전환 (권장)**

```typescript
// useItems.ts에서 층확인을 서버 파라미터로 전송
if (filters.floorConfirmation !== "all") {
  params.floor_confirmation = filters.floorConfirmation;
}
```

**🎯 방안 2: 클라이언트 필터링 완전 개선**

```typescript
// 필터링 후 총 개수 재계산
const filteredItems = clientSideFilter(items);
const actualTotalCount = Math.ceil(filteredItems.length / pageSize) * pageSize;

// 전체 페이지의 필터링된 데이터를 하나로 합쳐서 페이지네이션 재구성
```

**🎯 방안 3: 하이브리드 방식**

- 서버 사이드 가능한 필터는 서버에서 처리
- 불가능한 필터만 클라이언트에서 처리하되 총 개수/페이지네이션 동기화

#### **구현 세부사항:**

1. **백엔드 층확인 필터 지원 여부** 재확인
2. **총 검색 결과 수 실시간 업데이트** 로직 추가
3. **페이지네이션 재계산** - 필터링된 데이터 기준으로 재구성
4. **UX 개선**: 필터 적용 시 1페이지로 자동 이동

#### **우선순위:** 🔥 **높음** (사용자 혼란 방지 필수)

---

## 📊 **최종 수정된 우선순위**

### **🔥 긴급 수정 (즉시 처리 필요)**

1. **A. 지역 선택 로직 수정** ✅ **완료**
2. **B. 키워드 검색 기능 재구현** ✅ **완료**
3. **C. 서버 사이드 정렬 오작동 수정** ⚠️ **신규 발견**
4. **D. 클라이언트 사이드 필터링 개선** ⚠️ **신규 발견**

### **📋 진행 완료**

- **Phase 2**: 사용자 경험 개선 ✅ **100% 완료**

### **📋 이후 진행 예정**

- **Phase 3**: 고급 기능 (확인불가 옵션 등)

---

**🎯 총 예상 작업 시간: 14-18시간** (추가 수정 4시간 포함)
**📅 최종 진행 순서: 긴급 수정 C,D → Phase 3**

새롭게 발견된 문제들을 분석하고 해결 방안을 제시했습니다. 어떤 방안으로 진행하실지 알려주세요!
